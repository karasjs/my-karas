{"version":3,"file":"index.js","sources":["src/util.js","src/canvas1.js","src/canvas1n.js","src/canvas2.js","src/index.js"],"sourcesContent":["const toString = {}.toString;\n\nexport const isFunction = function(obj) {\n  return toString.call(obj) === '[object CallbackFunction]' || toString.call(obj) === '[object Function]';\n}\n","const CANVAS = {};\nconst CANVAS_LIST = [];\n\nexport default function injectCanvas1(karas, createVd, Root) {\n  class newRoot extends Root {\n    refresh(cb, isFirst) {\n      let self = this;\n      let ctx = self.ctx;\n      // 小程序bug，可能restore失败，刷新前手动restore下\n      ctx.restore();\n\n      function wrap() {\n        ctx.draw && ctx.draw(true, function() {\n          self.emit('myRefresh');\n        });\n      }\n\n      super.refresh(wrap, isFirst);\n    }\n  }\n\n  karas.createVd = function(tagName, props, children) {\n    if(['canvas', 'svg'].indexOf(tagName) > -1) {\n      return new newRoot(tagName, props, children);\n    }\n    return createVd(tagName, props, children);\n  };\n\n  const IMG = karas.inject.IMG;\n  const INIT = karas.inject.INIT;\n  const LOADING = karas.inject.LOADING;\n  const LOADED = karas.inject.LOADED;\n\n  karas.inject.checkSupportFontFamily = () => false\n\n  karas.inject.measureImg = function(url, cb, optinos = {}) {\n    if(url.indexOf('data:') === 0) {\n      let { width = {}, height = {} } = optinos;\n      cb({\n        success: true,\n        width: width.value,\n        height: height.value,\n        url,\n        source: url,\n      });\n      return;\n    }\n    let cache = IMG[url] = IMG[url] || {\n      state: INIT,\n      task: [],\n    };\n    if(cache.state === LOADED) {\n      cb(cache);\n    }\n    else if(cache.state === LOADING) {\n      cache.task.push(cb);\n    }\n    else {\n      cache.state = LOADING;\n      cache.task.push(cb);\n      my.getImageInfo({\n        src: url,\n        success: function(res) {\n          cache.state = LOADED;\n          cache.success = true;\n          cache.width = res.width;\n          cache.height = res.height;\n          cache.source = url;\n          cache.url = url;\n          let list = cache.task.splice(0);\n          list.forEach(cb => cb(cache));\n        },\n        fail: function() {\n          cache.state = LOADED;\n          cache.success = false;\n          cache.url = url;\n          let list = cache.task.splice(0);\n          list.forEach(cb => cb(cache));\n        },\n      });\n    }\n  };\n\n  karas.inject.isDom = function(o) {\n    return o && (o.getContext || o.arc);\n  }\n\n  karas.inject.hasCacheCanvas = function(key) {\n    return key && CANVAS.hasOwnProperty(key);\n  };\n  karas.inject.getCacheCanvas = function(w, h, key, message) {\n    if(message) {\n      key = message;\n    }\n    // console.log(message,CANVAS);\n    if(!CANVAS[key]) {\n      throw new Error('Need a cache canvas');\n    }\n    let o = CANVAS[key];\n    return {\n      ctx: o,\n      canvas: o,\n      draw() {\n        o.draw(true);\n      },\n    };\n  };\n  karas.inject.setCacheCanvas = function(k, v) {\n    CANVAS[k] = v;\n  };\n\n  karas.inject.releaseCacheCanvas = function(o) {\n    CANVAS_LIST.push(o);\n  };\n\n  karas.inject.delCacheCanvas = function(key) {\n    key && delete CANVAS[key];\n  };\n}\n","const CANVAS = {};\nconst CANVAS_LIST = [];\n\nexport default function injectCanvas1(karas, createVd, Root) {\n  class newRoot extends Root {\n    refresh(cb, isFirst) {\n      let self = this;\n      let ctx = self.ctx;\n      // 小程序bug，可能restore失败，刷新前手动restore下\n      ctx.restore();\n\n      function wrap() {\n        ctx.draw && ctx.draw(false, function() {\n          self.emit('myRefresh');\n        });\n      }\n\n      super.refresh(wrap, isFirst);\n    }\n  }\n\n  karas.createVd = function(tagName, props, children) {\n    if(['canvas', 'svg'].indexOf(tagName) > -1) {\n      return new newRoot(tagName, props, children);\n    }\n    return createVd(tagName, props, children);\n  };\n\n  const IMG = karas.inject.IMG;\n  const INIT = karas.inject.INIT;\n  const LOADING = karas.inject.LOADING;\n  const LOADED = karas.inject.LOADED;\n\n  karas.inject.checkSupportFontFamily = () => false\n\n  karas.inject.measureImg = function(url, cb, optinos = {}) {\n    if(url.indexOf('data:') === 0) {\n      let { width = {}, height = {} } = optinos;\n      cb({\n        success: true,\n        width: width.value,\n        height: height.value,\n        url,\n        source: url,\n      });\n      return;\n    }\n    let cache = IMG[url] = IMG[url] || {\n      state: INIT,\n      task: [],\n    };\n    if(cache.state === LOADED) {\n      cb(cache);\n    }\n    else if(cache.state === LOADING) {\n      cache.task.push(cb);\n    }\n    else {\n      cache.state = LOADING;\n      cache.task.push(cb);\n      my.getImageInfo({\n        src: url,\n        success: function(res) {\n          cache.state = LOADED;\n          cache.success = true;\n          cache.width = res.width;\n          cache.height = res.height;\n          cache.source = url;\n          cache.url = url;\n          let list = cache.task.splice(0);\n          list.forEach(cb => cb(cache));\n        },\n        fail: function() {\n          cache.state = LOADED;\n          cache.success = false;\n          cache.url = url;\n          let list = cache.task.splice(0);\n          list.forEach(cb => cb(cache));\n        },\n      });\n    }\n  };\n\n  karas.inject.isDom = function(o) {\n    return o && (o.getContext || o.arc);\n  }\n\n  karas.inject.hasCacheCanvas = function(key) {\n    return key && CANVAS.hasOwnProperty(key);\n  };\n  karas.inject.getCacheCanvas = function(w, h, key, message) {\n    if(message) {\n      key = message;\n    }\n    // console.log(message,CANVAS);\n    if(!CANVAS[key]) {\n      throw new Error('Need a cache canvas');\n    }\n    let o = CANVAS[key];\n    return {\n      ctx: o,\n      canvas: o,\n      draw() {\n        o.draw(false);\n      },\n    };\n  };\n  karas.inject.setCacheCanvas = function(k, v) {\n    CANVAS[k] = v;\n  };\n\n  karas.inject.releaseCacheCanvas = function(o) {\n    CANVAS_LIST.push(o);\n  };\n\n  karas.inject.delCacheCanvas = function(key) {\n    key && delete CANVAS[key];\n  };\n}\n","import karas from 'karas';\n\nfunction recursion(dom, hash) {\n  if(dom.tagName === 'img') {\n    if(dom.src) {\n      hash[dom.src] = true;\n    }\n  }\n  else if(Array.isArray(dom.children)) {\n    dom.children.forEach(item => {\n      recursion(item, hash);\n    });\n  }\n  let backgroundImage = dom.currentStyle[karas.enums.STYLE_KEY.BACKGROUND_IMAGE];\n  if(backgroundImage && /url/i.test(backgroundImage)) {\n    let url = /url(\\([^)]+\\))/.exec(backgroundImage);\n    if(url) {\n      hash[url[1]] = true;\n    }\n  }\n}\n\nconst IMG_COUNTER = {};\n\nlet cacheDom;\n\nexport default function() {\n  class Root extends karas.Root {\n    appendTo(dom) {\n      if(dom && (dom.getContext || dom.arc)) {\n        this.__dom = dom;\n        this.__ctx = dom.getContext('2d');\n      }\n      else {\n        this.__dom = {};\n        this.__ctx = dom;\n      }\n      this.__children = karas.builder.initRoot(this.__cd, this);\n      this.__initProps();\n      this.__root = this;\n      this.cache = !!this.props.cache;\n      this.__refreshLevel = karas.refresh.level.REFLOW;\n      this.__renderMode = karas.mode.CANVAS;\n      this.__defs = {\n        clear() {},\n      };\n      this.refresh(null, true);\n      if(this.__dom.__root) {\n        this.__dom.__root.destroy();\n      }\n      this.__dom.root = this;\n      // 收集img\n      let imgHash = {};\n      recursion(this, imgHash);\n      let imgList = [];\n      Object.keys(imgHash).forEach(url => {\n        imgList.push(url);\n        IMG_COUNTER[url] = IMG_COUNTER[url] || 0;\n        IMG_COUNTER[url]++;\n      });\n      this.__imgList = imgList;\n    }\n\n    refresh(cb, isFirst) {\n      let self = this;\n\n      function wrap() {\n        self.emit('myRefresh');\n      }\n\n      super.refresh(wrap, isFirst);\n    }\n\n    __destroy() {\n      super.__destroy();\n      if(Array.isArray(this.__imgList)) {\n        this.__imgList.forEach(url => {\n          if(IMG_COUNTER[url]) {\n            IMG_COUNTER[url]--;\n          }\n          if(!IMG_COUNTER[url]) {\n            delete karas.inject.IMG[url];\n          }\n        });\n      }\n    }\n  }\n\n  // Root引用指过来\n  let createVd = karas.createVd;\n  karas.createVd = function(tagName, props, children) {\n    if(['canvas', 'svg'].indexOf(tagName) > -1) {\n      return new Root(tagName, props, children);\n    }\n    return createVd(tagName, props, children);\n  };\n\n  const IMG = karas.inject.IMG;\n  const INIT = karas.inject.INIT;\n  const LOADING = karas.inject.LOADING;\n  const LOADED = karas.inject.LOADED;\n  if(!cacheDom) {\n    cacheDom = my._createOffscreenCanvas(1, 1);\n    karas.inject.requestAnimationFrame = cacheDom.requestAnimationFrame;\n  }\n\n  karas.inject.measureImg = function(url, cb, optinos = {}) {\n    let { width = 0, height = 0 } = optinos;\n\n    let cache = IMG[url] = IMG[url] || {\n      state: INIT,\n      task: [],\n    };\n    if(cache.state === LOADED) {\n      cb(cache);\n    }\n    else if(cache.state === LOADING) {\n      cache.task.push(cb);\n    }\n    else {\n      cache.state = LOADING;\n      cache.task.push(cb);\n      // base64特殊处理\n      if(url.indexOf('data:') === 0) {\n        let img = cacheDom.createImage();\n        img.onload = function() {\n          cache.state = LOADED;\n          cache.success = true;\n          cache.width = width;\n          cache.height = height;\n          cache.source = img;\n          cache.url = url;\n          let list = cache.task.splice(0);\n          list.forEach(cb => cb(cache));\n          img.onload = null;\n          img.onerror = null;\n        };\n        img.onerror = function() {\n          cache.state = LOADED;\n          cache.success = false;\n          cache.width = width;\n          cache.height = height;\n          cache.url = url;\n          let list = cache.task.splice(0);\n          list.forEach(cb => cb(cache));\n          img.onload = null;\n          img.onerror = null;\n        };\n        img.src = url;\n        return;\n      }\n      my.getImageInfo({\n        src: url,\n        success: function(res) {\n          let img = cacheDom.createImage();\n          img.onload = function() {\n            cache.state = LOADED;\n            cache.success = true;\n            cache.width = res.width;\n            cache.height = res.height;\n            cache.source = img;\n            cache.url = url;\n            let list = cache.task.splice(0);\n            list.forEach(cb => cb(cache));\n            img.onload = null;\n            img.onerror = null;\n          };\n          img.onerror = function() {\n            cache.state = LOADED;\n            cache.success = false;\n            cache.width = res.width;\n            cache.height = res.height;\n            cache.url = url;\n            let list = cache.task.splice(0);\n            list.forEach(cb => cb(cache));\n            img.onload = null;\n            img.onerror = null;\n          };\n          img.src = url;\n        },\n        fail: function() {\n          cache.state = LOADED;\n          cache.success = false;\n          cache.url = url;\n          let list = cache.task.splice(0);\n          list.forEach(cb => cb(cache));\n        },\n      });\n    }\n  };\n\n  karas.inject.isDom = function(o) {\n    return o && (o.getContext || o.arc);\n  }\n\n  const CANVAS = {};\n  const CANVAS_LIST = [];\n  const WEBGL_LIST = [];\n\n  function cache(key, width, height, hash, message) {\n    let o;\n    if(!key) {\n      let target = hash === CANVAS ? CANVAS_LIST : WEBGL_LIST;\n      if(target.length) {\n        o = target.pop();\n      }\n      else {\n        o = my._createOffscreenCanvas(width, height);\n      }\n    }\n    else if(!hash[key]) {\n      o = hash[key] = my._createOffscreenCanvas(width, height);\n    }\n    else {\n      o = hash[key];\n    }\n    o.width = width;\n    o.height = height;\n    return {\n      canvas: o,\n      ctx: hash === CANVAS ? o.getContext('2d')\n        : (o.getContext('webgl') || o.getContext('experimental-webgl')),\n      draw() {\n        // 空函数，仅对小程序提供hook特殊处理，flush缓冲\n      },\n      available: true,\n      release() {\n        if(!key) {\n          if(hash === CANVAS) {\n            CANVAS_LIST.push(this.canvas);\n          }\n          else {\n            WEBGL_LIST.push(this.canvas);\n          }\n        }\n        this.canvas = null;\n        this.ctx = null;\n      },\n    };\n  }\n\n  function cacheCanvas(key, width, height, message) {\n    return cache(key, width, height, CANVAS, message);\n  }\n\n  karas.inject.hasCacheCanvas = function(key) {\n    return key && CANVAS.hasOwnProperty(key);\n  };\n\n  karas.inject.getCacheCanvas = function(width, height, key, message) {\n    return cacheCanvas(key, width, height, message);\n  };\n\n  karas.inject.releaseCacheCanvas = function(o) {\n    CANVAS_LIST.push(o);\n  };\n\n  karas.inject.delCacheCanvas = function(key) {\n    key && delete CANVAS[key];\n  };\n};\n","import karas from 'karas';\nimport { version } from '../package.json';\nimport { isFunction } from './util';\nimport injectCanvas1 from './canvas1';\nimport injectCanvas1n from './canvas1n';\nimport injectCanvas2 from './canvas2';\n\nkaras.inject.requestAnimationFrame = function(cb) {\n  return setTimeout(cb, 1000 / 60);\n};\n\nkaras.myVersion = version;\n\nclass Root extends karas.Root {\n  static __isCanvas2 = false;\n\n  // 需要小程序内部监听事件手动调用\n  onEvent(e) {\n    this.__wrapEvent(e, data => {\n      this.__emitEvent(data);\n    });\n  }\n\n  __wrapEvent(e, cb) {\n    const id = this.__ctx?.id || this.__dom?.id;\n    id && my.createSelectorQuery().select(`#${id}`).boundingClientRect().exec(ret => {\n      let x, y;\n\n      if(ret && ret[0] && e.detail) {\n        const { clientX, clientY, x: ox, y: oy } = e.detail;\n        const { left, top, width, height } = ret[0];\n        const { __scx, __scy } = this;\n\n        x = ox ?? clientX - left;\n        y = oy ?? clientY - top;\n\n        if(!karas.util.isNil(__scx)) {\n          x /= __scx;\n        }\n        else {\n          x *= this.width / width;\n        }\n        if(!karas.util.isNil(__scy)) {\n          y /= __scy;\n        }\n        else {\n          y *= this.height / height;\n        }\n      }\n      cb({\n        event: e,\n        stopPropagation() {\n          this.__stopPropagation = true;\n        },\n        stopImmediatePropagation() {\n          this.__stopPropagation = true;\n          this.__stopImmediatePropagation = true;\n        },\n        preventDefault() {\n        },\n        x,\n        y,\n        __hasEmitted: false,\n      });\n    });\n  }\n\n  appendTo(dom) {\n    if(isFunction(dom.getContext)) {\n      if(Root.__isCanvas2) {\n        karas.inject.requestAnimationFrame = dom.requestAnimationFrame.bind(dom) || karas.inject.requestAnimationFrame;\n      }\n      this.__dom = dom;\n      this.__ctx = dom.getContext('2d');\n    }\n    else {\n      this.__dom = {};\n      this.__ctx = dom;\n    }\n    this.__children = karas.builder.initRoot(this.__cd, this);\n    this.__initProps();\n    this.__root = this;\n    this.cache = !!this.props.cache;\n    this.__refreshLevel = karas.refresh.level.REFLOW;\n    this.__renderMode = karas.mode.CANVAS;\n    this.__defs = {\n      clear() {\n      },\n    };\n    this.refresh(null, true);\n    if(this.__dom.__root) {\n      this.__dom.__root.destroy();\n    }\n    this.__dom.root = this;\n  }\n}\n\nconst createVd = karas.createVd;\n\nlet injected = false;\ninjectCanvas1(karas, createVd, Root);\n\nexport function setCanvasType(type) {\n  // 只允许注入一次\n  if(injected) {\n    return;\n  }\n  injected = true;\n  if(type === 'canvas2') {\n    Root.__isCanvas2 = true;\n    injectCanvas2(karas, createVd, Root);\n  }\n  else if(type === 'canvas1n') {\n    Root.__isCanvas1n = true;\n    injectCanvas1n(karas, createVd, Root);\n  }\n}\n\nexport default karas;\n"],"names":["toString","isFunction","obj","call","CANVAS","injectCanvas1","karas","createVd","Root","newRoot","cb","isFirst","self","ctx","restore","wrap","draw","emit","tagName","props","children","indexOf","IMG","inject","INIT","LOADING","LOADED","checkSupportFontFamily","measureImg","url","optinos","width","height","success","value","source","cache","state","task","push","my","getImageInfo","src","res","list","splice","forEach","fail","isDom","o","getContext","arc","hasCacheCanvas","key","hasOwnProperty","getCacheCanvas","w","h","message","Error","canvas","setCacheCanvas","k","v","releaseCacheCanvas","CANVAS_LIST","delCacheCanvas","recursion","dom","hash","Array","isArray","item","backgroundImage","currentStyle","enums","STYLE_KEY","BACKGROUND_IMAGE","test","exec","IMG_COUNTER","cacheDom","__dom","__ctx","__children","builder","initRoot","__cd","__initProps","__root","__refreshLevel","refresh","level","REFLOW","__renderMode","mode","__defs","clear","destroy","root","imgHash","imgList","Object","keys","__imgList","_createOffscreenCanvas","requestAnimationFrame","img","createImage","onload","onerror","WEBGL_LIST","target","length","pop","available","release","cacheCanvas","setTimeout","myVersion","version","e","__wrapEvent","data","__emitEvent","id","createSelectorQuery","select","boundingClientRect","ret","x","y","detail","clientX","clientY","ox","oy","left","top","__scx","__scy","util","isNil","event","stopPropagation","__stopPropagation","stopImmediatePropagation","__stopImmediatePropagation","preventDefault","__hasEmitted","__isCanvas2","bind","injected","setCanvasType","type","injectCanvas2","__isCanvas1n","injectCanvas1n"],"mappings":"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"}