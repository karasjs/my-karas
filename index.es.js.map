{"version":3,"file":"index.es.js","sources":["src/util.js","src/canvas1.js","src/canvas1n.js","src/canvas2.js","src/index.js"],"sourcesContent":["const toString = {}.toString;\n\nexport const isFunction = function(obj) {\n  return toString.call(obj) === '[object CallbackFunction]' || toString.call(obj) === '[object Function]';\n}\n","const CANVAS = {};\nconst CANVAS_LIST = [];\n\nexport default function injectCanvas1(karas, createVd, Root) {\n  class newRoot extends Root {\n    refresh(cb, isFirst) {\n      let self = this;\n      let ctx = self.ctx;\n      // 小程序bug，可能restore失败，刷新前手动restore下\n      ctx.restore();\n\n      function wrap() {\n        ctx.draw && ctx.draw(true, function() {\n          self.emit('myRefresh');\n        });\n      }\n\n      super.refresh(wrap, isFirst);\n    }\n  }\n\n  karas.createVd = function(tagName, props, children) {\n    if(['canvas', 'svg'].indexOf(tagName) > -1) {\n      return new newRoot(tagName, props, children);\n    }\n    return createVd(tagName, props, children);\n  };\n\n  const IMG = karas.inject.IMG;\n  const INIT = karas.inject.INIT;\n  const LOADING = karas.inject.LOADING;\n  const LOADED = karas.inject.LOADED;\n\n  karas.inject.checkSupportFontFamily = () => false\n\n  karas.inject.measureImg = function(url, cb, options = {}) {\n    if(url.indexOf('data:') === 0) {\n      let { width = {}, height = {} } = options;\n      cb({\n        success: true,\n        width: width.value,\n        height: height.value,\n        url,\n        source: url,\n      });\n      return;\n    }\n    let cache = IMG[url] = IMG[url] || {\n      state: INIT,\n      task: [],\n    };\n    if(cache.state === LOADED) {\n      cb(cache);\n    }\n    else if(cache.state === LOADING) {\n      cache.task.push(cb);\n    }\n    else {\n      cache.state = LOADING;\n      cache.task.push(cb);\n      my.getImageInfo({\n        src: url,\n        success: function(res) {\n          cache.state = LOADED;\n          cache.success = true;\n          cache.width = res.width;\n          cache.height = res.height;\n          cache.source = url;\n          cache.url = url;\n          let list = cache.task.splice(0);\n          list.forEach(cb => cb(cache));\n        },\n        fail: function() {\n          cache.state = LOADED;\n          cache.success = false;\n          cache.url = url;\n          let list = cache.task.splice(0);\n          list.forEach(cb => cb(cache));\n        },\n      });\n    }\n  };\n\n  karas.inject.isDom = function(o) {\n    return o && (o.getContext || o.arc);\n  }\n\n  karas.inject.hasCacheCanvas = function(key) {\n    return key && CANVAS.hasOwnProperty(key);\n  };\n  karas.inject.getCacheCanvas = function(w, h, key, message) {\n    if(message) {\n      key = message;\n    }\n    // console.log(message,CANVAS);\n    if(!CANVAS[key]) {\n      throw new Error('Need a cache canvas');\n    }\n    let o = CANVAS[key];\n    return {\n      ctx: o,\n      canvas: o,\n      draw() {\n        o.draw(true);\n      },\n    };\n  };\n  karas.inject.setCacheCanvas = function(k, v) {\n    CANVAS[k] = v;\n  };\n\n  karas.inject.releaseCacheCanvas = function(o) {\n    CANVAS_LIST.push(o);\n  };\n\n  karas.inject.delCacheCanvas = function(key) {\n    key && delete CANVAS[key];\n  };\n}\n","const CANVAS = {};\nconst CANVAS_LIST = [];\n\nexport default function injectCanvas1(karas, createVd, Root) {\n  class newRoot extends Root {\n    refresh(cb, isFirst) {\n      let self = this;\n      let ctx = self.ctx;\n      // 小程序bug，可能restore失败，刷新前手动restore下\n      ctx.restore();\n\n      function wrap() {\n        ctx.draw && ctx.draw(false, function() {\n          self.emit('myRefresh');\n        });\n      }\n\n      super.refresh(wrap, isFirst);\n    }\n  }\n\n  karas.createVd = function(tagName, props, children) {\n    if(['canvas', 'svg'].indexOf(tagName) > -1) {\n      return new newRoot(tagName, props, children);\n    }\n    return createVd(tagName, props, children);\n  };\n\n  const IMG = karas.inject.IMG;\n  const INIT = karas.inject.INIT;\n  const LOADING = karas.inject.LOADING;\n  const LOADED = karas.inject.LOADED;\n\n  karas.inject.checkSupportFontFamily = () => false\n\n  karas.inject.measureImg = function(url, cb, optinos = {}) {\n    if(url.indexOf('data:') === 0) {\n      let { width = {}, height = {} } = optinos;\n      cb({\n        success: true,\n        width: width.value,\n        height: height.value,\n        url,\n        source: url,\n      });\n      return;\n    }\n    let cache = IMG[url] = IMG[url] || {\n      state: INIT,\n      task: [],\n    };\n    if(cache.state === LOADED) {\n      cb(cache);\n    }\n    else if(cache.state === LOADING) {\n      cache.task.push(cb);\n    }\n    else {\n      cache.state = LOADING;\n      cache.task.push(cb);\n      my.getImageInfo({\n        src: url,\n        success: function(res) {\n          cache.state = LOADED;\n          cache.success = true;\n          cache.width = res.width;\n          cache.height = res.height;\n          cache.source = url;\n          cache.url = url;\n          let list = cache.task.splice(0);\n          list.forEach(cb => cb(cache));\n        },\n        fail: function() {\n          cache.state = LOADED;\n          cache.success = false;\n          cache.url = url;\n          let list = cache.task.splice(0);\n          list.forEach(cb => cb(cache));\n        },\n      });\n    }\n  };\n\n  karas.inject.isDom = function(o) {\n    return o && (o.getContext || o.arc);\n  }\n\n  karas.inject.hasCacheCanvas = function(key) {\n    return key && CANVAS.hasOwnProperty(key);\n  };\n  karas.inject.getCacheCanvas = function(w, h, key, message) {\n    if(message) {\n      key = message;\n    }\n    // console.log(message,CANVAS);\n    if(!CANVAS[key]) {\n      throw new Error('Need a cache canvas');\n    }\n    let o = CANVAS[key];\n    return {\n      ctx: o,\n      canvas: o,\n      draw() {\n        o.draw(false);\n      },\n    };\n  };\n  karas.inject.setCacheCanvas = function(k, v) {\n    CANVAS[k] = v;\n  };\n\n  karas.inject.releaseCacheCanvas = function(o) {\n    CANVAS_LIST.push(o);\n  };\n\n  karas.inject.delCacheCanvas = function(key) {\n    key && delete CANVAS[key];\n  };\n}\n","import karas from 'karas';\n\nfunction recursion(dom, hash) {\n  if(dom.tagName === 'img') {\n    if(dom.src) {\n      hash[dom.src] = true;\n    }\n  }\n  else if(Array.isArray(dom.children)) {\n    dom.children.forEach(item => {\n      recursion(item, hash);\n    });\n  }\n  let backgroundImage = dom.currentStyle[karas.enums.STYLE_KEY.BACKGROUND_IMAGE];\n  if(backgroundImage && /url/i.test(backgroundImage)) {\n    let url = /url(\\([^)]+\\))/.exec(backgroundImage);\n    if(url) {\n      hash[url[1]] = true;\n    }\n  }\n}\n\nconst IMG_COUNTER = {};\n\nlet cacheDom;\n\nexport default function() {\n  class Root extends karas.Root {\n    appendTo(dom) {\n      if(dom && (dom.getContext || dom.arc)) {\n        this.__dom = dom;\n        this.__ctx = dom.getContext('2d');\n      }\n      else {\n        this.__dom = {};\n        this.__ctx = dom;\n      }\n      this.__children = karas.builder.initRoot(this.__cd, this);\n      this.__initProps();\n      this.__root = this;\n      this.cache = !!this.props.cache;\n      this.__refreshLevel = karas.refresh.level.REFLOW;\n      this.__renderMode = karas.mode.CANVAS;\n      this.__defs = {\n        clear() {},\n      };\n      this.refresh(null, true);\n      if(this.__dom.__root) {\n        this.__dom.__root.destroy();\n      }\n      this.__dom.root = this;\n      // 收集img\n      let imgHash = {};\n      recursion(this, imgHash);\n      let imgList = [];\n      Object.keys(imgHash).forEach(url => {\n        imgList.push(url);\n        IMG_COUNTER[url] = IMG_COUNTER[url] || 0;\n        IMG_COUNTER[url]++;\n      });\n      this.__imgList = imgList;\n    }\n\n    refresh(cb, isFirst) {\n      let self = this;\n\n      function wrap() {\n        self.emit('myRefresh');\n      }\n\n      super.refresh(wrap, isFirst);\n    }\n\n    __destroy() {\n      super.__destroy();\n      if(Array.isArray(this.__imgList)) {\n        this.__imgList.forEach(url => {\n          if(IMG_COUNTER[url]) {\n            IMG_COUNTER[url]--;\n          }\n          if(!IMG_COUNTER[url]) {\n            delete karas.inject.IMG[url];\n          }\n        });\n      }\n    }\n  }\n\n  // Root引用指过来\n  let createVd = karas.createVd;\n  karas.createVd = function(tagName, props, children) {\n    if(['canvas', 'svg'].indexOf(tagName) > -1) {\n      return new Root(tagName, props, children);\n    }\n    return createVd(tagName, props, children);\n  };\n\n  const IMG = karas.inject.IMG;\n  const INIT = karas.inject.INIT;\n  const LOADING = karas.inject.LOADING;\n  const LOADED = karas.inject.LOADED;\n  if(!cacheDom) {\n    if(my.createOffscreenCanvas) {\n      cacheDom = my.createOffscreenCanvas(1, 1);\n    }\n    else {\n      cacheDom = my._createOffscreenCanvas(1, 1);\n    }\n    karas.inject.requestAnimationFrame = cacheDom.requestAnimationFrame;\n  }\n\n  karas.inject.measureImg = function(url, cb, optinos = {}) {\n    let { width = 0, height = 0 } = optinos;\n\n    let cache = IMG[url] = IMG[url] || {\n      state: INIT,\n      task: [],\n    };\n    if(cache.state === LOADED) {\n      cb(cache);\n    }\n    else if(cache.state === LOADING) {\n      cache.task.push(cb);\n    }\n    else {\n      cache.state = LOADING;\n      cache.task.push(cb);\n      // base64特殊处理\n      if(url.indexOf('data:') === 0) {\n        let img = cacheDom.createImage();\n        img.onload = function() {\n          cache.state = LOADED;\n          cache.success = true;\n          cache.width = width;\n          cache.height = height;\n          cache.source = img;\n          cache.url = url;\n          let list = cache.task.splice(0);\n          list.forEach(cb => cb(cache));\n          img.onload = null;\n          img.onerror = null;\n        };\n        img.onerror = function() {\n          cache.state = LOADED;\n          cache.success = false;\n          cache.width = width;\n          cache.height = height;\n          cache.url = url;\n          let list = cache.task.splice(0);\n          list.forEach(cb => cb(cache));\n          img.onload = null;\n          img.onerror = null;\n        };\n        img.src = url;\n        return;\n      }\n      my.getImageInfo({\n        src: url,\n        success: function(res) {\n          let img = cacheDom.createImage();\n          img.onload = function() {\n            cache.state = LOADED;\n            cache.success = true;\n            cache.width = res.width;\n            cache.height = res.height;\n            cache.source = img;\n            cache.url = url;\n            let list = cache.task.splice(0);\n            list.forEach(cb => cb(cache));\n            img.onload = null;\n            img.onerror = null;\n          };\n          img.onerror = function() {\n            cache.state = LOADED;\n            cache.success = false;\n            cache.width = res.width;\n            cache.height = res.height;\n            cache.url = url;\n            let list = cache.task.splice(0);\n            list.forEach(cb => cb(cache));\n            img.onload = null;\n            img.onerror = null;\n          };\n          img.src = url;\n        },\n        fail: function() {\n          cache.state = LOADED;\n          cache.success = false;\n          cache.url = url;\n          let list = cache.task.splice(0);\n          list.forEach(cb => cb(cache));\n        },\n      });\n    }\n  };\n\n  karas.inject.isDom = function(o) {\n    return o && (o.getContext || o.arc);\n  }\n\n  const CANVAS = {};\n  const CANVAS_LIST = [];\n  const WEBGL_LIST = [];\n\n  function cache(key, width, height, hash, message) {\n    let o;\n    if(!key) {\n      let target = hash === CANVAS ? CANVAS_LIST : WEBGL_LIST;\n      if(target.length) {\n        o = target.pop();\n      }\n      else {\n        if(my.createOffscreenCanvas) {\n          o = my.createOffscreenCanvas(width, height);\n        }\n        else {\n          o = my._createOffscreenCanvas(width, height);\n        }\n      }\n    }\n    else if(!hash[key]) {\n      if(my.createOffscreenCanvas) {\n        o = hash[key] = my.createOffscreenCanvas(width, height);\n      }\n      else {\n        o = hash[key] = my._createOffscreenCanvas(width, height);\n      }\n    }\n    else {\n      o = hash[key];\n    }\n    o.width = width;\n    o.height = height;\n    return {\n      canvas: o,\n      ctx: hash === CANVAS ? o.getContext('2d')\n        : (o.getContext('webgl') || o.getContext('experimental-webgl')),\n      draw() {\n        // 空函数，仅对小程序提供hook特殊处理，flush缓冲\n      },\n      available: true,\n      release() {\n        if(!key) {\n          if(hash === CANVAS) {\n            CANVAS_LIST.push(this.canvas);\n          }\n          else {\n            WEBGL_LIST.push(this.canvas);\n          }\n        }\n        this.canvas = null;\n        this.ctx = null;\n      },\n    };\n  }\n\n  function cacheCanvas(key, width, height, message) {\n    return cache(key, width, height, CANVAS, message);\n  }\n\n  karas.inject.hasCacheCanvas = function(key) {\n    return key && CANVAS.hasOwnProperty(key);\n  };\n\n  karas.inject.getCacheCanvas = function(width, height, key, message) {\n    return cacheCanvas(key, width, height, message);\n  };\n\n  karas.inject.releaseCacheCanvas = function(o) {\n    CANVAS_LIST.push(o);\n  };\n\n  karas.inject.delCacheCanvas = function(key) {\n    key && delete CANVAS[key];\n  };\n};\n","import karas from 'karas';\nimport { version } from '../package.json';\nimport { isFunction } from './util';\nimport injectCanvas1 from './canvas1';\nimport injectCanvas1n from './canvas1n';\nimport injectCanvas2 from './canvas2';\n\nkaras.inject.requestAnimationFrame = function(cb) {\n  return setTimeout(cb, 1000 / 60);\n};\n\nkaras.myVersion = version;\n\nclass Root extends karas.Root {\n  static __isCanvas2 = false;\n\n  // 需要小程序内部监听事件手动调用\n  onEvent(e) {\n    this.__wrapEvent(e, data => {\n      this.__emitEvent(data);\n    });\n  }\n\n  __wrapEvent(e, cb) {\n    const id = this.__ctx?.id || this.__dom?.id;\n    id && my.createSelectorQuery().select(`#${id}`).boundingClientRect().exec(ret => {\n      let x, y;\n\n      if(ret && ret[0] && e.detail) {\n        const { clientX, clientY, x: ox, y: oy } = e.detail;\n        const { left, top, width, height } = ret[0];\n        const { __scx, __scy } = this;\n\n        x = ox ?? clientX - left;\n        y = oy ?? clientY - top;\n\n        if(!karas.util.isNil(__scx)) {\n          x /= __scx;\n        }\n        else {\n          x *= this.width / width;\n        }\n        if(!karas.util.isNil(__scy)) {\n          y /= __scy;\n        }\n        else {\n          y *= this.height / height;\n        }\n      }\n      cb({\n        event: e,\n        stopPropagation() {\n          this.__stopPropagation = true;\n        },\n        stopImmediatePropagation() {\n          this.__stopPropagation = true;\n          this.__stopImmediatePropagation = true;\n        },\n        preventDefault() {\n        },\n        x,\n        y,\n        __hasEmitted: false,\n      });\n    });\n  }\n\n  appendTo(dom) {\n    if(isFunction(dom.getContext)) {\n      if(Root.__isCanvas2) {\n        karas.inject.requestAnimationFrame = dom.requestAnimationFrame.bind(dom) || karas.inject.requestAnimationFrame;\n      }\n      this.__dom = dom;\n      this.__ctx = dom.getContext('2d');\n    }\n    else {\n      this.__dom = {};\n      this.__ctx = dom;\n    }\n    this.__children = karas.builder.initRoot(this.__cd, this);\n    this.__initProps();\n    this.__root = this;\n    this.__refreshLevel = karas.refresh.level.REFLOW;\n    this.__renderMode = karas.mode.CANVAS;\n    this.__defs = {\n      clear() {\n      },\n    };\n    this.refresh(null, true);\n    if(this.__dom.__root) {\n      this.__dom.__root.destroy();\n    }\n    this.__dom.__root = this;\n  }\n}\n\nconst createVd = karas.createVd;\n\nlet injected = false;\ninjectCanvas1(karas, createVd, Root);\n\nexport function setCanvasType(type) {\n  // 只允许注入一次\n  if(injected) {\n    return;\n  }\n  injected = true;\n  if(type === 'canvas2') {\n    Root.__isCanvas2 = true;\n    injectCanvas2(karas, createVd, Root);\n  }\n  else if(type === 'canvas1n') {\n    Root.__isCanvas1n = true;\n    injectCanvas1n(karas, createVd, Root);\n  }\n}\n\nexport default karas;\n"],"names":["toString","isFunction","obj","call","CANVAS","injectCanvas1","karas","createVd","Root","newRoot","cb","isFirst","self","ctx","restore","wrap","draw","emit","tagName","props","children","indexOf","IMG","inject","INIT","LOADING","LOADED","checkSupportFontFamily","measureImg","url","options","width","height","success","value","source","cache","state","task","push","my","getImageInfo","src","res","list","splice","forEach","fail","isDom","o","getContext","arc","hasCacheCanvas","key","hasOwnProperty","getCacheCanvas","w","h","message","Error","canvas","setCacheCanvas","k","v","releaseCacheCanvas","CANVAS_LIST","delCacheCanvas","optinos","recursion","dom","hash","Array","isArray","item","backgroundImage","currentStyle","enums","STYLE_KEY","BACKGROUND_IMAGE","test","exec","IMG_COUNTER","cacheDom","__dom","__ctx","__children","builder","initRoot","__cd","__initProps","__root","__refreshLevel","refresh","level","REFLOW","__renderMode","mode","__defs","clear","destroy","root","imgHash","imgList","Object","keys","__imgList","createOffscreenCanvas","_createOffscreenCanvas","requestAnimationFrame","img","createImage","onload","onerror","WEBGL_LIST","target","length","pop","available","release","cacheCanvas","setTimeout","myVersion","version","e","__wrapEvent","data","__emitEvent","id","createSelectorQuery","select","boundingClientRect","ret","x","y","detail","clientX","clientY","ox","oy","left","top","__scx","__scy","util","isNil","event","stopPropagation","__stopPropagation","stopImmediatePropagation","__stopImmediatePropagation","preventDefault","__hasEmitted","__isCanvas2","bind","injected","setCanvasType","type","injectCanvas2","__isCanvas1n","injectCanvas1n"],"mappings":"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"}